function checkForClasses(e){return e.className?" ":""}function cleanHTML(e){return e.replace(/(<([^>]+)>)/gi,"")}function debounce(e,a,n){var t;return function(){var r=this,o=arguments,i=function(){t=null,n||e.apply(r,o)},s=n&&!t;clearTimeout(t),t=setTimeout(i,a),s&&e.apply(r,o)}}function findParent(e,a){for(;e;){if(e.classList&&e.classList.contains(a))return e;e=e.parentNode}return null}function isMobile(e,a){var n=window.innerWidth/e,t=document.documentElement.clientWidth/e,r=document.body.clientWidth/e;return a>=(n||t||r)}function mergeArray(e,a){for(var n=e.concat(a),t=0;t<n.length;++t)for(var r=t+1;r<n.length;++r)n[t]===n[r]&&n.splice(r--,1);return n}function addFieldsetClasses(){var e="fieldset:not(.polls) dl:not(.pmlist) dd",a=document.querySelectorAll(e),n=document.querySelectorAll(e+' input[type="radio"]');if(a&&a.length)for(var t=0;t<a.length;t++){var r=a[t];r.children.length>1&&(r.className+=checkForClasses(r)+"has-multiple-fields"),-1!==r.innerHTML.indexOf("&nbsp;")&&(r.className+=checkForClasses(r)+"has-space")}if(n&&n.length)for(var t=0;t<n.length;t++){var o=n[t];o.parentNode.className+=checkForClasses(o.parentNode)+"has-radio-button"}}function addForumImageClass(){var e=document.querySelectorAll(".list-inner .forum-image");if(e&&e.length)for(var a=0;a<e.length;a++){var n=e[a],t=findParent(n,"row-item");t.className+=checkForClasses(t)+"has-forum-image"}}function addImageWrapper(e){var a=document.querySelectorAll(e);if(a&&a.length)for(var n=0;n<a.length;n++){var t=a[n],r=document.createElement("div");r.setAttribute("class","image-wrap"),t.parentNode.insertBefore(r,t),r.appendChild(t)}}function addImageBackground(e,a){var n=document.querySelectorAll(e);if(n&&n.length)for(var t=0;t<n.length;t++){var r=n[t],o=r.getAttribute("src"),i="image-fit image-fit-default",s=r.parentNode;if(a){var l=o.match(/(\d+x\d+)/g),c=o.match(/.(jpg|jpeg|gif|png)/g);l?o=o.replace(l,a):c&&(o=o.replace(c,"-"+a+c)),i=i.replace("image-fit-default","image-fit-responsive")}s.style.backgroundImage="url("+o+")",s.className+=checkForClasses(s)+i}}function addNoPaginationClass(){var e=document.querySelector(".action-bar .pagination");if(e){var a=e.innerText.toLowerCase(),n="page 1 of 1";if(-1!==a.indexOf(n)){var t=new RegExp(n,"gi"),r=a.replace(t,"").match(/\d+/g);r&&0>=r&&(body.className+=checkForClasses(body)+"no-pagination")}}}function addSearchIgnoredClass(){var e=document.querySelectorAll(".search.post .postbody");if(e&&e.length)for(var a=0;a<e.length;a++){var n=e[a];-1!==n.innerHTML.indexOf("ignore list")&&(n.className+=checkForClasses(n)+"ignore")}}function addThanksClass(){var e=document.querySelectorAll("#viewprofile .extra-details h3");if(e&&e.length)for(var a=0;a<e.length;a++){var n=e[a];if(-1!==n.innerHTML.indexOf("Thanks list")){var t=findParent(n,"panel");t.className+=checkForClasses(t)+"member-thanks-list"}}}function bannerCodeGenerator(e,a){function n(e,a,n){var o=e.target||e.srcElement,i="//"+window.location.hostname+"/"+o.getAttribute("src").replace("./","");t.innerHTML=r.replace(a,i).replace(n,o.getAttribute("alt"))}var t=document.querySelector(a);if(t)for(var r=t.innerHTML,o=r.match(/src=\"(.*?)\"/)[1],i=r.match(/alt=\"(.*?)\"/)[1],s=document.querySelectorAll(e),l=0;l<s.length;l++)s[l].onclick=function(e){n(e,o,i)}}function checkForNewPM(){var e=document.querySelectorAll('.cp-menu ul li a[href*="folder"]');if(e&&e.length)for(var a=0;a<e.length;a++){var n=e[a];-1!==n.innerHTML.indexOf("strong")&&(n.className+=checkForClasses(n)+"new-pm")}}function checkForEmpty(e){var a=document.querySelectorAll(e);if(a&&a.length)for(var n=0;n<a.length;n++)a[n].parentNode.style.display="none"}function detectiPhone(){navigator.userAgent.match(/iPhone|iPad|iPod/i)&&(body.className+=checkForClasses(body)+"ios")}function moveRankText(){var e=document.querySelectorAll("table.table1 .rank-img");if(e&&e.length)for(var a=0;a<e.length;a++){var n=e[a];n.parentNode.appendChild(n),"TD"!=n.parentNode.nodeName&&"td"!=n.parentNode.nodeName||(n.parentNode.className+=checkForClasses(n.parentNode)+"name")}}function noContentListing(){var e=["This board has no forums.","You do not have the required permissions to view or read topics within this forum.","There are no topics or posts in this forum.","This category has no forums.","No suitable matches were found."],a=document.querySelectorAll(".action-bar + .panel");if(a&&a.length)for(var n=0;n<a.length;n++){var t=a[n];-1!==e.indexOf(t.innerText.trim())&&(t.className+=checkForClasses(t)+"no-content")}}function toggleElements(e,a,n,t){function r(e,a){return e=e+" - "+a,e.toLowerCase().replace(/\'/,"").replace(/[^a-z0-9]+/g,"-").replace(/-+/,"-")}function o(e,t){var r=findParent(t,n).querySelector(a),o={"con-col":"toggle-content-collapsed","con-exp":"toggle-content-expanded","btn-col":"toggle-button-collapsed","btn-exp":"toggle-button-expanded"};e?(i(t,o["btn-col"],o["btn-exp"]),i(r,o["con-col"],o["con-exp"])):(i(t,o["btn-exp"],o["btn-col"]),i(r,o["con-exp"],o["con-col"]))}function i(e,a,n){e.classList.remove(a),e.classList.add(n)}function s(e){return"undefined"!=typeof Storage&&t?window.localStorage.setItem(c,JSON.stringify(e)):null}var l=document.querySelectorAll(e),c="khy-toggles";if("undefined"!=typeof Storage&&localStorage.getItem(c)&&t)var d=JSON.parse(localStorage.getItem(c));else var d={};if(l&&l.length){var u=l[0].getAttribute("data-toggle-type");d.hasOwnProperty(u)||(d[u]={});for(var p=0;p<l.length;p++){var e=l[p],h=r(e.getAttribute("data-toggle-name"),e.getAttribute("data-toggle-id"));d[u].hasOwnProperty(h)?d[u][h]=d[u][h]:d[u][h]=e.getAttribute("data-toggle-state"),findParent(e,n).classList.add("has-toggle-content"),o(d[u][h],e),e.onclick=function(){return function(e){var a=e.target||e.srcElement;h=r(a.getAttribute("data-toggle-name"),a.getAttribute("data-toggle-id")),d[u][h]=!d[u][h],s(d),o(d[u][h],a)}}()}s(d)}}function checkForSpace(e){var a=jQuery(e);a&&a.length&&a.each(function(){var e=jQuery(this);"&nbsp;"==e.html()||"<label>&nbsp;</label>"==e.html()?e.addClass("empty-space"):e.removeClass("empty-space")})}function addScrollableArea(e,a,n){(e&&e.length||n&&n.length)&&(e[0].scrollHeight>a?(e.addClass("scrollable"),e.wrapInner('<div class="scrollable-wrapper"></div>')):n.hide())}function addAttachmentIcon(){var e=jQuery(".attach-image");e&&e.length&&e.each(function(){jQuery(this).prepend('<span class="image-open" onclick="viewableArea(this);"><i class="icon icon-xl fa-search-plus fa-fw" aria-hidden="true"></i></span>')})}function updateaAttachmentDisplay(e){var a=jQuery(e);a&&a.length&&a.on("click",function(e){var a=jQuery(this).closest(".file").parent();a.hasClass("image-expanded")?a.removeClass("image-expanded"):a.addClass("image-expanded")})}function formatDisplayActions(){var e=jQuery(".display-actions");e&&e.length&&e.each(function(){var e=jQuery(this);e.html(e.html().replace(/&nbsp;/g,"").replace(/::/g,"&bull;"));var a=e.find(" div a");-1!==a.text().toLowerCase().indexOf("mark")&&a.parent("div").addClass("mark-actions");var n=e.children("select");n.each(function(){jQuery(this).next(".button1, .button2").addBack().wrapAll('<div class="select-actions"></div>')}),e.wrapInner('<div class="display-actions-wrapper"></div>')})}function hidePMPostBox(){var e=jQuery("#pmheader-postingbox");e&&e.length&&0==e.find("fieldset.fields1").children().length&&e.hide()}function addCPWrapper(){var e=jQuery(".cp-menu"),a=jQuery(".cp-main");(e&&e.length||a&&a.length)&&(e.parent().addClass("cp-wrapper"),a.parent().addClass("cp-wrapper"))}function toggleContent(e,a,n,t){var e=jQuery(e);e&&e.length&&e.off().on("click",function(){var e=jQuery(this),r=jQuery(a);"prev"==t?r=e.prev(a):"next"==t&&(r=e.next(a)),r.hasClass(n)?r.removeClass(n):r.addClass(n)})}function toggleMemberDisplay(){var e=jQuery(".profile-tabs");if(e&&e.length){var a=e.find("ul li a[data-tabname]");a.on("click",function(){var e=jQuery(this);a.parent().removeClass("activetab"),e.parent().addClass("activetab");var n=e.attr("data-tabname");jQuery(".tab-panel").each(function(){var e=jQuery(this);e.hasClass(n)?e.addClass("show-panel").removeClass("hide-panel"):e.addClass("hide-panel").removeClass("show-panel")})})}}function toggleMapDisplay(){var e=jQuery(".map-tabs");if(e&&e.length){var a=e.find("ul li a[data-tabname]");a.on("click",function(){var e=jQuery(this);e.parent().hasClass("activetab")?e.parent().removeClass("activetab"):e.parent().addClass("activetab");var a=e.attr("data-tabname"),n=jQuery(".map ."+a);n.hasClass("hide-panel")?n.addClass("show-panel").removeClass("hide-panel"):n.addClass("hide-panel").removeClass("show-panel")})}}function addOnScroll(e,a,n){var t=jQuery(window);if(t&&t.length){var a=jQuery(a).offset().top,r=!1;t.scroll(function(){0==r?t.scrollTop()>a&&(jQuery(e).addClass(n),r=!0):t.scrollTop()<=a&&(jQuery(e).removeClass(n),r=!1)})}}function scrollOnPage(e,a,n){var t=jQuery(e);t&&t.length&&(addOnScroll(".scroll-to-links",".site-description","scroll-to-visible"),t.on("click",function(){return jQuery("html, body").animate({scrollTop:n},1e3),!1}))}function initializeDiscordList(){var e=jQuery(".discord-channel-status .discord-channel-list"),a="<li>There's no one online right now. :( Check back later.</li>",n=jQuery.ajax({type:"GET",url:"//discordapp.com/api/guilds/482924002411806732/widget.json",dataType:"json"});n.done(function(n){var t=n.members||!1,r=["memoria"],o=["algaliarept"];if(t&&t.length>0){t=t.filter(function(e){e.rank=3,e.group="user";var a=e.username.toLowerCase();return o.indexOf(a)>-1?(e.rank=2,e.group="moderator"):r.indexOf(a)>-1&&(e.rank=1,e.group="admin"),e}),t.sort(function(e,a){return e.rank-a.rank});for(var i=t.length,s=12,l=i>s?s:i,c=0;l>c;c++){var d=t[c],u="//khyeras.org/styles/khyeras_v1/theme/images/no_avatar.gif";d.avatar_url&&(u=d.avatar_url.replace(/^http(s?):/i,""));var p="Discord Avatar - "+d.username,h='<span class="discord-avatar image-wrap"><img src="'+u+'" class="user-avatar" alt="'+p+'" title="'+p+'" /></span>',g='<span class="discord-username">'+d.username+"</span>",f='<li class="discord-'+d.group+" discord-status-"+d.status+'">'+h+g+"</li>";e.append(f)}i>s&&e.append('<li class="discord-more-users"><a href="//discord.gg/MXtzbmw" target="_blank">...more users online</a></li>')}else e.append(a)}),n.fail(function(){e.append(a)})}function initializeDropdownMenu(e,a){var n="dropdown-visible",t="dropdown-not-visible",e=jQuery(e),r=jQuery(a);e.off().on("click",function(){var e=jQuery(this).closest(a);e.hasClass(n)?(r.removeClass(t),e.removeClass(n)):(r.removeClass(n).addClass(t),e.removeClass(t).addClass(n))}),e&&e.length&&jQuery(document).off().on("click",function(e){jQuery(e.target).closest(a).length||r.removeClass(n).removeClass(t)})}function initializeMobileMenu(e){function a(){i.hasClass("show")?(i.removeClass("show"),jQuery("body, html").removeClass("mobile-open")):(i.addClass("show"),jQuery("body, html").addClass("mobile-open"))}function n(){var e=isMobile(baseFontSize,c/baseFontSize);e?d||(jQuery(".mobile-menu-header .fa-close").off().on("click",function(){a()}),t.detach().appendTo(s),d=!0):d&&(t.detach().appendTo(r),jQuery("body, html").removeClass("mobile-open"),i.removeClass("show"),d=!1)}var t=jQuery(e.menu),r=jQuery(e.menuContainer),o=jQuery(e.mobileButton),i=jQuery(e.mobileMenu),s=jQuery(e.mobileContent),l=jQuery(e.mobileOverlay),c=e.width,d=!1;o.off().on("click",function(){a()}),l.off().on("click",function(){a()}),n();var u=debounce(function(){n()},100);window.addEventListener("resize",u)}function updateProfileFields(){function e(){L.each(function(){m=jQuery(this),"ucp"==f?(M.prop("disabled",!0),m.prop("disabled",!0)):m.is("select")?c(m,!1):m.is('input[type="checkbox"]')?u(m,!1):m.val("").prop("disabled",!0)})}function a(e){e?jQuery(".error-msg-chracter, .character-fields").addClass("hide-fields"):jQuery(".error-msg-chracter, .character-fields").removeClass("hide-fields")}function n(){k=d(R),y=O.find('input[type="checkbox"]:checked'),C=g("#pf_c_race_opts_1"),k==A||k==F?I.each(function(){if(m=jQuery(this),k==F&&1==C){j=h(y);var e=mergeArray(characterRules[j].exRace,nonHalf);e&&p(e,h(m),m),o()}else k==A&&1==C||k==F&&2==C?(m.is(":checked")||u(m,!1),c(q,!0)):(k==A?u(m,!0):k==F&&p(nonHalf,h(m),m),o())}):(u(I,!1),c(q,!1)),"Writer"==accType&&"ucp"==f&&q.prop("disabled",!0)}function t(e){var a=[];return I.each(function(){if(m=jQuery(this),v=h(m),"Kerasoka"==v&&(K=m),m.is(":checked")){var n=characterRules[v].exClass;n&&(a=e!=F||"Dwarf"!=v||K.is(":checked")?mergeArray(a,n):dragonClasses)}}),a}function r(){k=d(R),Q=d(q);var e=t(k);y=B.find('input[type="checkbox"]:checked'),x=g("#pf_c_class_opts_1"),Q==N||Q==T?H.each(function(){m=jQuery(this),Q==N&&1==x||Q==T&&2==x?m.is(":checked")||u(m,!1):Q!=S&&p(e,h(m),m)}):u(H,!1)}function o(){c(q,!1),u(H,!1)}function i(){_=d(z),y=W.find('input[type="checkbox"]:checked'),w=g("#pf_c_religion_opts_1"),_==P||_==D?E.each(function(){m=jQuery(this),w>3?m.is(":checked")||u(m,!1):_!=S&&religionRules[_]?p(religionRules[_],h(m),m,"include"):u(m,!1)}):u(E,!1)}function s(e,a){var n;e.find("option").each(function(){m=jQuery(this),m.prop("disabled",!1),m.text().trim()==a&&(n=m.val())}),e.prop("disabled",!1).val(n)}function l(e,a){e.each(function(){m=jQuery(this),v=h(m),u(m,!1),v==a&&m.prop({disabled:!1,checked:!0})})}function c(e,a){a?(e.prop("disabled",!1),e.find("option").each(function(){jQuery(this).prop("disabled",!1)})):(e.prop("disabled",!0),e.find("option").each(function(a){var n=jQuery(this);n.prop("disabled",!0),n.text().trim()==S&&e.val(n.val())}))}function d(e){return e.find("option:selected").text().trim()}function u(e,a){a?e.prop("disabled",!1):e.prop({disabled:!0,checked:!1})}function p(e,a,n,t){var r=!1,o=!0;"include"==t&&(r=!0,o=!1),e.indexOf(a)>-1?u(n,r):u(n,o)}function h(e){return e[0].nextSibling.nodeValue.trim()}function g(e){return jQuery(e).closest("dd").find('input[type="checkbox"]:checked').length}if(jQuery("body").hasClass("section-ucp-register")||jQuery("body").hasClass("section-ucp-edit-profile")){if(jQuery("body").hasClass("section-ucp-register"))var f="register";else var f="ucp";var m,y,v,b,C,k,j,x,Q,w,_,S="-- Please Select --",A="Full blooded",F="Half-breed",N="Single",T="Dual",P="Archaicism",D="Idolism",M=jQuery("#pf_account_type"),L=jQuery("[id^=pf_c_]"),R=jQuery("#pf_c_race_type"),I=jQuery('input[name="pf_c_race_opts[]"]'),O=jQuery("#pf_c_race_opts_1").closest("dd"),q=jQuery("#pf_c_class_type"),H=jQuery('input[name="pf_c_class_opts[]"]'),B=jQuery("#pf_c_class_opts_1").closest("dd"),z=jQuery("#pf_c_religion_type"),E=jQuery('input[name="pf_c_religion_opts[]"]'),W=jQuery("#pf_c_religion_opts_1").closest("dd");"undefined"==typeof accType&&(accType=!1),b=d(M),"Writer"==accType||"Writer"==b||b==S?(e(),a(!0)):a(!1),M.on("change",function(){e(),a(!0),b=d(M),"Character"==b&&(a(!1),c(R,!0),c(z,!0),jQuery('input[id^=pf_c_][type="text"], input[id^=pf_c_][type="number"], textarea[id^=pf_c_]').prop("disabled",!1))}),R.on("change",function(){k=d(R),u(I,!1),o(),k==A?u(I,!0):k==F&&jQuery.each(I,function(){m=jQuery(this),p(nonHalf,h(m),m)})}),n(),I.on("change",function(){n()}),q.on("change",function(){if(k=d(R),Q=d(q),u(H,!1),Q!=S){var e=t(k);jQuery.each(H,function(){m=jQuery(this),p(e,h(m),m)})}}),r(),H.on("change",function(){r()});var K=K||!1;z.on("change",function(){_=d(z),u(E,!1),_!=S&&religionRules[_]?jQuery.each(E,function(){m=jQuery(this),p(religionRules[_],h(m),m,"include")}):u(E,!1)}),i(),E.on("change",function(){i()}),jQuery(".page-body").on("submit","#register, #ucp.edit-profile-form",function(a){b=d(M),"Writer"==b&&(e(),s(R,A),l(I,"Human"),s(q,N),l(H,"Bard"),"ucp"==f&&s(M,"Writer"))})}}var body=document.querySelector("body"),baseFontSize=16,bottomDistance=document.body.scrollHeight+window.innerHeight,dragonClasses=["Physical","Magical","Restoration"],magicClasses=["Cleric","Druid","Sorcerer","Summoner","Wizard"],all=["All"],nonHalf=["Dragon","Ghost","Korcai"],characterRules={Dragon:{exRace:all,exClass:["Alchemist","Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Summoner","Wizard"]},Dwarf:{exRace:["Elemental","Fae","Lumeacia","Ue'drahc"],exClass:mergeArray(magicClasses,dragonClasses)},Elemental:{exRace:["Dwarf","Ue'drahc"],exClass:dragonClasses},Fae:{exRace:["Dwarf","Lumeacia","Ue'drahc"],exClass:dragonClasses},Ghost:{exRace:all,exClass:dragonClasses},Human:{exRace:["Lumeacia"],exClass:dragonClasses},Kerasoka:{exRace:["Ue'drahc"],exClass:mergeArray(magicClasses,dragonClasses)},Korcai:{exRace:all,exClass:dragonClasses},Lumeacia:{exRace:["Dwarf","Fae","Human","Shapeshifter","Ue'drahc"],exClass:dragonClasses},Shapeshifter:{exRace:["Lumeacia","Ue'drahc"],exClass:dragonClasses},"Ue'drahc":{exRace:["Dwarf","Elemental","Fae","Kerasoka","Lumeacia","Shapeshifter"],exClass:dragonClasses}},religionRules={Archaicism:["Dainyil","Ixaziel","Ny'tha","Pheriss","Ristgir"],Idolism:["Ahm'kela","Cecilia","Bhelest","Esyrax","Faryv","Faunir","Iodrah","Kaxitaki","Kelorha","Lahiel","Misanyt","Nilbein","Veditova"]};addForumImageClass(),addFieldsetClasses(),addNoPaginationClass(),addThanksClass(),moveRankText(),noContentListing(),addSearchIgnoredClass(),checkForNewPM(),checkForEmpty(".section-mcp-post-details .pagination ul"),bannerCodeGenerator(".link-banners img","#link-banner-code code"),addImageWrapper(".notification_list .list-inner > img"),addImageWrapper(".notification_list .notification-block > img"),addImageBackground(".page-welcome .image-wrap img",!1),addImageBackground(".postprofile .avatar img",!1),addImageBackground(".dropdown-container .user-avatar img",!1),addImageBackground(".forum-image img","1000x500"),addImageBackground(".excerpt .excerpt-image img","1000x500"),detectiPhone(),toggleElements(".forabg .toggle-button",".topiclist.forums","inner",!0),jQuery(document).ready(function(e){checkForSpace("fieldset dl dt"),checkForSpace("dl.details dt"),addScrollableArea(e(".topicreview"),400,e(".review .right-box")),addScrollableArea(e(".mcp-main #post_details"),400,e(".mcp-main .post-buttons #expand")),addAttachmentIcon(),updateaAttachmentDisplay(".image-open"),updateaAttachmentDisplay(".attach-image img"),formatDisplayActions(),hidePMPostBox(),addCPWrapper(),toggleContent(".toggle-links a","#page-welcome .site-links","toggle-show",""),toggleContent(".toggle-featured a","#featured-content","toggle-show",""),toggleContent(".bbcode-hidden-toggle",".bbcode-hidden-text","toggle-show","prev"),toggleContent(".card-filter-button",".card-changed","toggle-hide",""),toggleMemberDisplay(),toggleMapDisplay(),e("body").hasClass("simple-phpbb")||(addOnScroll("#page-header .navbar",".header-overlay","sticky"),addOnScroll(".quick-links",".site-description","quick-links-visible"),scrollOnPage(".scroll-to-top",100,0),scrollOnPage(".scroll-to-bottom",100,bottomDistance)),initializeDiscordList(),initializeDropdownMenu(".menu-trigger",".menu > li"),initializeMobileMenu({menu:"#page-header .navbar .wrapper > ul",menuContainer:"#page-header .navbar .wrapper",mobileButton:".mobile-menu-button",mobileMenu:"#mobile-menu",mobileContent:".mobile-menu-content",mobileOverlay:"#mobile-overlay",width:768}),updateProfileFields()});