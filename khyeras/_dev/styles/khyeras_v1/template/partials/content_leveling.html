{% set max_level = 60 %}
{% set multiplier = max_level / 5 %}
{% set level_mods = range(25, 50, 0.5) %}

{% set card = [] %}

{% for i in range(1, max_level) %}
	{% set modifier_index = ((i / 5) | round(0, 'ceil') - 1) %}

	{% if KHY_USER_LEVEL && i <= KHY_USER_LEVEL %}
		{% set icon = 'icon-bg-green fa-heart' %}
	{% else %}
		{% set icon = 'icon-bg-red fa-close' %}
	{% endif %}

	{% set experience = (level_mods[modifier_index] * i * (i - 1)) | number_format(0, '.', ',') %}

	{% if i % 10 == 0 %}
		{% set bonus = 'HP and MP increase.' %}
	{% else %}
		{% set bonus = 'No bonus.' %}
	{% endif %}

	{% set actual_level = ((i < (10)) ? '0' : '') ~ i %}

	{% set cards_add = [{
		title      : 'Level ' ~ actual_level,
		level      : actual_level,
		icon       : icon,
		experience : experience ? experience : '&#48;',
		bonus      : bonus
	}] %}

	{% set card = card | merge(cards_add) %}
{% endfor %}

{% if KHY_USER_LEVEL %}
	{% set completed_cards = [] %}
	{% for i in range(1, KHY_USER_LEVEL) %}
		{% set current_level = 'level-' ~ ((i < (10)) ? '0' : '') ~ i %}
		{% set completed_cards = completed_cards | merge([current_level]) %}
	{% endfor %}
{% endif %}

{% if completed_cards %}
	<section class="page-content-section">
		<div class="card-filter">
			<button class="card-filter-button toggle-button-show button-link" type="button">
				<i class="icon rpg-icon rpg-pokecog"></i>
				<span>completed levels</span>
			</button>
		</div>
	</section>
{% endif %}

{% for detail in card %}
	{% if detail.level % multiplier == 1 %}
		{% set card_name = 'Levels ' ~ detail.level ~ ' to ' ~ (detail.level - 1 + multiplier) %}
		<section id="{{ function.create_handle(card_name) }}" class="page-content-section toggleable-section" data-quick-name="{{ card_name }}">
			<h3>
				<button class="toggle-button button-link" type="button" data-toggle-type="level" data-toggle-id="{{ detail.level }}" data-toggle-name="{{ card_name }}" data-toggle-state="true" data-toggle-mobile="false"><i class="icon icon-xl fa-angle-up menu-trigger"></i></button> {{ card_name }}
			</h3>
			<div class="card-grid">
	{% endif %}
	{% set card_changed = (completed_cards && (function.create_handle(detail.title)) in completed_cards) ? true : false %}
	<div class="card-block{% if card_changed %} card-changed card-opacity{% endif %}">
		<h5 class="card-title">{{ detail.title }}</h5>
		<div class="icon-wrapper">
			<i class="icon icon-round {{ detail.icon }}" aria-hidden="true"></i>
		</div>
		<div class="card-description">
			{% if card_changed %}
				<span class="card-completed-text">
					<i class="icon rpg-icon rpg-stars-stack" aria-hidden="true"></i> Level complete!
				</span>
			{% endif %}
			<span class="card-description-wrapper">Requirements and details on {{ detail.level }} are listed below.</span>
		</div>
		<div class="card-clear"></div>
		{% if detail.experience || detail.bonus %}
			<dl class="details details-small">
				{% if detail.experience %}
					<dt>Experience:</dt>
					<dd>{{ detail.experience }}</dd>
				{% endif %}
				{% if detail.bonus %}
					<dt>Bonus:</dt>
					<dd>{{ detail.bonus }}</dd>
				{% endif %}
			</dl>
		{% endif %}
	</div>
	{% if detail.level % multiplier == 0 %}
			</div>
		</section>
	{% endif %}
{% endfor %}
